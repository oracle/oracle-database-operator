$ kubectl apply -f oraclerestart_prov_nodeports.yaml

-- Before the memory and cpu change:
$ kubectl describe oraclerestarts.database.oracle.com/oraclerestart-sample -n orestart
Name:         oraclerestart-sample
Namespace:    orestart
Labels:       <none>
Annotations:  OracleRestarts.database.oracle.com/old-spec:
                {"instDetails":{"name":"dbmc1","hostSwLocation":"/scratch/orestart/","workerNode":["10.0.10.58"],"envFile":"dbmc1oraclerestart-sample-cmap...
API Version:  database.oracle.com/v4
Kind:         OracleRestart
Metadata:
  Creation Timestamp:  2026-02-16T01:29:30Z
  Finalizers:
    database.oracle.com/oraclerestartfinalizer
  Generation:        1
  Resource Version:  301920451
  UID:               bce4942d-6656-42fe-a958-b72a8f93ba49
Spec:
  Asm Disk Group Details:
    Disks:
      /dev/disk/by-partlabel/asm-disk1
      /dev/disk/by-partlabel/asm-disk2
    Name:        DATA
    Redundancy:  EXTERNAL
    Type:        CRSDG
  Config Params:
    Cpu Count:    4
    Db Base:      /u01/app/oracle
    Db Char Set:  AL32UTF8
    Db Home:      /u01/app/oracle/product/19c/dbhome_1
    Db Name:      PORCLCDB
    Db Response File:
    Db Sw Zip File:  db_home.zip
    Grid Base:       /u01/app/grid
    Grid Home:       /u01/app/19c/grid
    Grid Response File:
    Grid Sw Zip File:        grid_home.zip
    Host Sw Stage Location:  /scratch/software/stage
    Inventory:               /u01/app/oraInventory
    Pga Size:                4G
    Processes:               2000
    Sga Size:                8G
    Sw Mount Location:       /u01
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Enable Ons:                 enable
  Image:                      dbocir/oracle/database-orestart:19.3.0-slim
  Image Pull Policy:          IfNotPresent
  Inst Details:
    Host Sw Location:  /scratch/orestart/
    Name:              dbmc1
    Worker Node:
      10.0.10.58
  Lb Service:
  Node Port Svc:
    Name:  dbmc1-service-nodeport
    Port Mappings:
      Node Port:    30007
      Port:         1521
      Protocol:     TCP
      Target Port:  1521
      Node Port:    30200
      Port:         6200
      Protocol:     TCP
      Target Port:  6200
    Svc Type:       nodeport
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Service Details:
    Name:  soepdb
  Ssh Key Secret:
    Key Mount Location:    /mnt/.ssh
    Name:                  ssh-key-secret
    Priv Key Secret Name:  ssh-privkey
    Pub Key Secret Name:   ssh-pubkey
Status:
  Oracle Restart Nodes:
    Name:  dbmc1-0
    Node Details:
      Instance State:  OPEN
      Pod State:       AVAILABLE
      Cluster State:   HEALTHY
      Mounted Devices:
        /dev/disk/by-partlabel/asm-disk1
        /dev/disk/by-partlabel/asm-disk2
      State:  AVAILABLE
  Asm Disk Groups:
    Disks:
      Name:        /dev/disk/by-partlabel/asm-disk1
      Size In Gb:  49
      Valid:       true
      Name:        /dev/disk/by-partlabel/asm-disk2
      Size In Gb:  49
      Valid:       true
    Name:          DATA
    Redundancy:    EXTERN
    Type:          CRSDG
  Conditions:
    Last Transition Time:  2026-02-16T01:29:40Z
    Message:               reconcile completed successfully
    Observed Generation:   1
    Reason:                LastReconcileCycleCompleted
    Status:                True
    Type:                  ReconcileComplete
  Config Params:
    Db Base:  /u01/app/oracle
    Db Home:  /u01/app/oracle/product/19c/dbhome_1
    Db Name:  PORCLCDB
    Db Response File:
    Grid Base:  /u01/app/grid
    Grid Home:  /u01/app/19c/grid
    Grid Response File:
    Inventory:     /u01/app/oraInventory
  Connect String:  dbmc1-0:1521/PORCLCDB
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Db State:                   OPEN
  External Connect String:    129.146.0.149:30007/soepdb
  Pdb Connect String:         dbmc1-0:1521/ORCLPDB
  Release Update:             19.28.0.0.0
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Role:        PRIMARY
  Security Context:
    Sysctls:
      Name:   kernel.shmmax
      Value:  9663676416
      Name:   kernel.shmall
      Value:  2359296
      Name:   kernel.sem
      Value:  250 32000 100 128
      Name:   kernel.shmmni
      Value:  4096
  Service Details:
    Name:       soepdb
    Svc State:  service soepdb is running
  State:        AVAILABLE
Events:         <none>


- from inside the Oracle Restart Pod:
[root@dbmc1-0 rac-work-dir]# cat /sys/fs/cgroup/memory/memory.limit_in_bytes
17179869184
[root@dbmc1-0 rac-work-dir]#
[root@dbmc1-0 rac-work-dir]# cat /sys/fs/cgroup/cpu/cpu.cfs_quota_us
400000




-- Attempt the memory and cpu change:
$ kubectl apply -f oraclerestart_prov_nodeports_mcpu_change.yaml

-- After the memory and cpu change:
-- The Oracle Restart Database Pod will be recreated:

$ kubectl get all -n orestart
NAME          READY   STATUS        RESTARTS   AGE   IP            NODE         NOMINATED NODE   READINESS GATES
pod/dbmc1-0   1/1     Terminating   0          37m   10.244.0.46   10.0.10.58   <none>           <none>

NAME                                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE   SELECTOR
service/dbmc1-0                          ClusterIP   None           <none>        <none>                          37m   statefulset.kubernetes.io/pod-name=dbmc1-0
service/dbmc1-service-nodeport-0-npsvc   NodePort    10.96.234.52   <none>        1521:30007/TCP,6200:30200/TCP   37m   statefulset.kubernetes.io/pod-name=dbmc1-0

NAME                     READY   AGE   CONTAINERS   IMAGES
statefulset.apps/dbmc1   1/1     37m   dbmc1        dbocir/oracle/database-orestart:19.3.0-slim



$ kubectl get all -n orestart
NAME          READY   STATUS    RESTARTS   AGE   IP            NODE         NOMINATED NODE   READINESS GATES
pod/dbmc1-0   0/1     Running   0          49s   10.244.0.48   10.0.10.58   <none>           <none>

NAME                                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE   SELECTOR
service/dbmc1-0                          ClusterIP   None           <none>        <none>                          38m   statefulset.kubernetes.io/pod-name=dbmc1-0
service/dbmc1-service-nodeport-0-npsvc   NodePort    10.96.234.52   <none>        1521:30007/TCP,6200:30200/TCP   38m   statefulset.kubernetes.io/pod-name=dbmc1-0

NAME                     READY   AGE   CONTAINERS   IMAGES
statefulset.apps/dbmc1   0/1     38m   dbmc1        dbocir/oracle/database-orestart:19.3.0-slim


-- After some time:
$ kubectl get all -n orestart
NAME          READY   STATUS    RESTARTS   AGE     IP            NODE         NOMINATED NODE   READINESS GATES
pod/dbmc1-0   1/1     Running   0          2m10s   10.244.0.48   10.0.10.58   <none>           <none>

NAME                                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE   SELECTOR
service/dbmc1-0                          ClusterIP   None           <none>        <none>                          39m   statefulset.kubernetes.io/pod-name=dbmc1-0
service/dbmc1-service-nodeport-0-npsvc   NodePort    10.96.234.52   <none>        1521:30007/TCP,6200:30200/TCP   39m   statefulset.kubernetes.io/pod-name=dbmc1-0

NAME                     READY   AGE   CONTAINERS   IMAGES
statefulset.apps/dbmc1   1/1     39m   dbmc1        dbocir/oracle/database-orestart:19.3.0-slim



-- Memory and CPU changes will be reflected as below:

$ kubectl describe oraclerestarts.database.oracle.com/oraclerestart-sample -n orestart
Name:         oraclerestart-sample
Namespace:    orestart
Labels:       <none>
Annotations:  OracleRestarts.database.oracle.com/old-spec:
                {"instDetails":{"name":"dbmc1","hostSwLocation":"/scratch/orestart/","workerNode":["10.0.10.58"],"envFile":"dbmc1oraclerestart-sample-cmap...
API Version:  database.oracle.com/v4
Kind:         OracleRestart
Metadata:
  Creation Timestamp:  2026-02-16T01:29:30Z
  Finalizers:
    database.oracle.com/oraclerestartfinalizer
  Generation:        2
  Resource Version:  301921876
  UID:               bce4942d-6656-42fe-a958-b72a8f93ba49
Spec:
  Asm Disk Group Details:
    Disks:
      /dev/disk/by-partlabel/asm-disk1
      /dev/disk/by-partlabel/asm-disk2
    Name:        DATA
    Redundancy:  EXTERNAL
    Type:        CRSDG
  Config Params:
    Cpu Count:    4
    Db Base:      /u01/app/oracle
    Db Char Set:  AL32UTF8
    Db Home:      /u01/app/oracle/product/19c/dbhome_1
    Db Name:      PORCLCDB
    Db Response File:
    Db Sw Zip File:  db_home.zip
    Grid Base:       /u01/app/grid
    Grid Home:       /u01/app/19c/grid
    Grid Response File:
    Grid Sw Zip File:        grid_home.zip
    Host Sw Stage Location:  /scratch/software/stage
    Inventory:               /u01/app/oraInventory
    Pga Size:                4G
    Processes:               2000
    Sga Size:                8G
    Sw Mount Location:       /u01
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Enable Ons:                 enable
  Image:                      dbocir/oracle/database-orestart:19.3.0-slim
  Image Pull Policy:          IfNotPresent
  Inst Details:
    Host Sw Location:  /scratch/orestart/
    Name:              dbmc1
    Worker Node:
      10.0.10.58
  Lb Service:
  Node Port Svc:
    Name:  dbmc1-service-nodeport
    Port Mappings:
      Node Port:    30007
      Port:         1521
      Protocol:     TCP
      Target Port:  1521
      Node Port:    30200
      Port:         6200
      Protocol:     TCP
      Target Port:  6200
    Svc Type:       nodeport
  Resources:
    Limits:
      Cpu:     8
      Memory:  20Gi
    Requests:
      Cpu:     8
      Memory:  20Gi

  Service Details:
    Name:  soepdb
  Ssh Key Secret:
    Key Mount Location:    /mnt/.ssh
    Name:                  ssh-key-secret
    Priv Key Secret Name:  ssh-privkey
    Pub Key Secret Name:   ssh-pubkey
Status:
  Oracle Restart Nodes:
    Name:  dbmc1-0
    Node Details:
      Instance State:  OPEN
      Pod State:       AVAILABLE
      Cluster State:   HEALTHY
      Mounted Devices:
        /dev/disk/by-partlabel/asm-disk1
        /dev/disk/by-partlabel/asm-disk2
      State:  AVAILABLE
  Asm Disk Groups:
    Disks:
      Name:        /dev/disk/by-partlabel/asm-disk1
      Size In Gb:  49
      Valid:       true
      Name:        /dev/disk/by-partlabel/asm-disk2
      Size In Gb:  49
      Valid:       true
    Name:          DATA
    Redundancy:    EXTERN
    Type:          CRSDG
  Conditions:
    Last Transition Time:  2026-02-16T01:29:40Z
    Message:               reconcile completed successfully
    Observed Generation:   1
    Reason:                LastReconcileCycleCompleted
    Status:                True
    Type:                  ReconcileComplete
  Config Params:
    Db Base:  /u01/app/oracle
    Db Home:  /u01/app/oracle/product/19c/dbhome_1
    Db Name:  PORCLCDB
    Db Response File:
    Grid Base:  /u01/app/grid
    Grid Home:  /u01/app/19c/grid
    Grid Response File:
    Inventory:     /u01/app/oraInventory
  Connect String:  dbmc1-0:1521/PORCLCDB
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Db State:                   OPEN
  External Connect String:    129.146.0.149:30007/soepdb
  Pdb Connect String:         dbmc1-0:1521/ORCLPDB
  Release Update:             19.28.0.0.0
  Resources:
    Limits:
      Cpu:     8
      Memory:  20Gi
    Requests:
      Cpu:     8
      Memory:  20Gi
  Role:        PRIMARY
  Security Context:
    Sysctls:
      Name:   kernel.shmmax
      Value:  10737418240
      Name:   kernel.shmall
      Value:  2621440
      Name:   kernel.sem
      Value:  250 32000 100 128
      Name:   kernel.shmmni
      Value:  4096
  Service Details:
    Name:       soepdb
    Svc State:  service soepdb is running
  State:        AVAILABLE
Events:         <none>



- from inside the Oracle Restart Pod:
[root@dbmc1-0 rac-work-dir]# cat /sys/fs/cgroup/memory/memory.limit_in_bytes
21474836480
[root@dbmc1-0 rac-work-dir]#
[root@dbmc1-0 rac-work-dir]# cat /sys/fs/cgroup/cpu/cpu.cfs_quota_us
800000