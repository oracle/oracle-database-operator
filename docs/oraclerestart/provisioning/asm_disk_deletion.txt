#### Status before the ASM Disk deletion

$ kubectl describe oraclerestarts.database.oracle.com/oraclerestart-sample -n orestart
Name:         oraclerestart-sample
Namespace:    orestart
Labels:       <none>
Annotations:  OracleRestarts.database.oracle.com/old-spec:
                {"instDetails":{"name":"dbmc1","hostSwLocation":"/scratch/orestart/","workerNode":["10.0.10.58"],"envFile":"dbmc1oraclerestart-sample-cmap...
API Version:  database.oracle.com/v4
Kind:         OracleRestart
Metadata:
  Creation Timestamp:  2026-02-16T02:34:41Z
  Finalizers:
    database.oracle.com/oraclerestartfinalizer
  Generation:        1
  Resource Version:  301940382
  UID:               585057f4-5fb2-46e1-a525-0642f6179336
Spec:
  Asm Disk Group Details:
    Disks:
      /dev/disk/by-partlabel/asm-disk1
      /dev/disk/by-partlabel/asm-disk2
    Name:        DATA
    Redundancy:  EXTERNAL
    Type:        CRSDG
  Config Params:
    Cpu Count:    4
    Db Base:      /u01/app/oracle
    Db Char Set:  AL32UTF8
    Db Home:      /u01/app/oracle/product/19c/dbhome_1
    Db Name:      PORCLCDB
    Db Response File:
    Db Sw Zip File:  db_home.zip
    Grid Base:       /u01/app/grid
    Grid Home:       /u01/app/19c/grid
    Grid Response File:
    Grid Sw Zip File:        grid_home.zip
    Host Sw Stage Location:  /scratch/software/stage
    Inventory:               /u01/app/oraInventory
    Pga Size:                4G
    Processes:               2000
    Sga Size:                8G
    Sw Mount Location:       /u01
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Enable Ons:                 enable
  Image:                      dbocir/oracle/database-orestart:19.3.0-slim
  Image Pull Policy:          IfNotPresent
  Inst Details:
    Host Sw Location:  /scratch/orestart/
    Name:              dbmc1
    Worker Node:
      10.0.10.58
  Lb Service:
  Node Port Svc:
    Name:  dbmc1-service-nodeport
    Port Mappings:
      Node Port:    30007
      Port:         1521
      Protocol:     TCP
      Target Port:  1521
      Node Port:    30200
      Port:         6200
      Protocol:     TCP
      Target Port:  6200
    Svc Type:       nodeport
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Service Details:
    Name:  soepdb
  Ssh Key Secret:
    Key Mount Location:    /mnt/.ssh
    Name:                  ssh-key-secret
    Priv Key Secret Name:  ssh-privkey
    Pub Key Secret Name:   ssh-pubkey
Status:
  Oracle Restart Nodes:
    Name:  dbmc1-0
    Node Details:
      Instance State:  OPEN
      Pod State:       AVAILABLE
      Cluster State:   HEALTHY
      Mounted Devices:
        /dev/disk/by-partlabel/asm-disk1
        /dev/disk/by-partlabel/asm-disk2
      State:  AVAILABLE
  Asm Disk Groups:
    Disks:
      Name:        /dev/disk/by-partlabel/asm-disk1
      Size In Gb:  49
      Valid:       true
      Name:        /dev/disk/by-partlabel/asm-disk2
      Size In Gb:  49
      Valid:       true
    Name:          DATA
    Redundancy:    EXTERN
    Type:          CRSDG
  Conditions:
    Last Transition Time:  2026-02-16T02:34:52Z
    Message:               reconcile completed successfully
    Observed Generation:   1
    Reason:                LastReconcileCycleCompleted
    Status:                True
    Type:                  ReconcileComplete
  Config Params:
    Db Base:  /u01/app/oracle
    Db Home:  /u01/app/oracle/product/19c/dbhome_1
    Db Name:  PORCLCDB
    Db Response File:
    Grid Base:  /u01/app/grid
    Grid Home:  /u01/app/19c/grid
    Grid Response File:
    Inventory:     /u01/app/oraInventory
  Connect String:  dbmc1-0:1521/PORCLCDB
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Db State:                   OPEN
  External Connect String:    129.146.0.149:30007/soepdb
  Pdb Connect String:         dbmc1-0:1521/ORCLPDB
  Release Update:             19.28.0.0.0
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Role:        PRIMARY
  Security Context:
    Sysctls:
      Name:   kernel.shmmax
      Value:  9663676416
      Name:   kernel.shmall
      Value:  2359296
      Name:   kernel.sem
      Value:  250 32000 100 128
      Name:   kernel.shmmni
      Value:  4096
  Service Details:
    Name:       soepdb
    Svc State:  service soepdb is running
  State:        AVAILABLE
Events:         <none>




-- from inside the Oracle Restart Database Pod:
[grid@dbmc1-0 ~]$ export ORACLE_SID=+ASM
[grid@dbmc1-0 ~]$ asmcmd lsdsk
Path
/dev/disk/by-partlabel/asm-disk1
/dev/disk/by-partlabel/asm-disk2
[grid@dbmc1-0 ~]$
[grid@dbmc1-0 ~]$ ls -lrt /dev/disk/by-partlabel/asm-disk*
brw-rw----. 1 grid asmadmin 8, 33 Feb 16 03:11 /dev/disk/by-partlabel/asm-disk1
brw-rw----. 1 grid asmadmin 8, 49 Feb 16 03:11 /dev/disk/by-partlabel/asm-disk2
[grid@dbmc1-0 ~]$
[grid@dbmc1-0 ~]$ sqlplus "/ as sysasm"

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Feb 16 03:11:40 2026
Version 19.28.0.0.0

Copyright (c) 1982, 2025, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.28.0.0.0

SQL> set lines 200
SQL> col path format a50
SQL> select group_number, disk_number, name, total_mb, free_mb, path from v$asm_disk;

GROUP_NUMBER DISK_NUMBER NAME				  TOTAL_MB    FREE_MB PATH
------------ ----------- ------------------------------ ---------- ---------- --------------------------------------------------
	   1	       1 DATA_0001			     51196	46580 /dev/disk/by-partlabel/asm-disk2
	   1	       0 DATA_0000			     51196	46588 /dev/disk/by-partlabel/asm-disk1

SQL> ALTER DISKGROUP DATA DROP DISK 'DATA_0001' REBALANCE POWER 10;

Diskgroup altered.

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

EST_MINUTES   EST_WORK	   ACTUAL      SOFAR
----------- ---------- ---------- ----------
	  0	     0	       10	   0
	  0	  1151	       10	  10
	  0	     0	       10	   0

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

EST_MINUTES   EST_WORK	   ACTUAL      SOFAR
----------- ---------- ---------- ----------
	  0	     0	       10	   0
	  1	  1151	       10	 130
	  0	     0	       10	   0

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

EST_MINUTES   EST_WORK	   ACTUAL      SOFAR
----------- ---------- ---------- ----------
	  0	     0	       10	   0
	  0	  1151	       10	 789
	  0	     0	       10	   0

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

EST_MINUTES   EST_WORK	   ACTUAL      SOFAR
----------- ---------- ---------- ----------
	  0	     0	       10	   0
	  0	  1151	       10	1003
	  0	     0	       10	   0

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

EST_MINUTES   EST_WORK	   ACTUAL      SOFAR
----------- ---------- ---------- ----------
	  0	     0	       10	   0
	  0	  1151	       10	1122
	  0	     0	       10	   0

SQL> select EST_MINUTES,EST_WORK,ACTUAL,SOFAR from v$asm_operation;

no rows selected

SQL> select group_number, disk_number, name, total_mb, free_mb, path from v$asm_disk;

GROUP_NUMBER DISK_NUMBER NAME				  TOTAL_MB    FREE_MB PATH
------------ ----------- ------------------------------ ---------- ---------- --------------------------------------------------
	   0	       0					 0	    0 /dev/disk/by-partlabel/asm-disk2
	   1	       0 DATA_0000			     51196	41984 /dev/disk/by-partlabel/asm-disk1

SQL>


### Apply the file "orestart_prov_asm_disk_deletion.yaml" to delete an exising ASM Disk

###############################################################
### During this operation, the "pod/dbmc1-0" will be recreated
###############################################################



### Status after the Disk removed:

$ kubectl describe oraclerestarts.database.oracle.com/oraclerestart-sample -n orestart
Name:         oraclerestart-sample
Namespace:    orestart
Labels:       <none>
Annotations:  OracleRestarts.database.oracle.com/old-spec:
                {"instDetails":{"name":"dbmc1","hostSwLocation":"/scratch/orestart/","workerNode":["10.0.10.58"],"envFile":"dbmc1oraclerestart-sample-cmap...
API Version:  database.oracle.com/v4
Kind:         OracleRestart
Metadata:
  Creation Timestamp:  2026-02-16T02:34:41Z
  Finalizers:
    database.oracle.com/oraclerestartfinalizer
  Generation:        2
  Resource Version:  301943596
  UID:               585057f4-5fb2-46e1-a525-0642f6179336
Spec:
  Asm Disk Group Details:
    Disks:
      /dev/disk/by-partlabel/asm-disk1
    Name:        DATA
    Redundancy:  EXTERNAL
    Type:        CRSDG
  Config Params:
    Cpu Count:    4
    Db Base:      /u01/app/oracle
    Db Char Set:  AL32UTF8
    Db Home:      /u01/app/oracle/product/19c/dbhome_1
    Db Name:      PORCLCDB
    Db Response File:
    Db Sw Zip File:  db_home.zip
    Grid Base:       /u01/app/grid
    Grid Home:       /u01/app/19c/grid
    Grid Response File:
    Grid Sw Zip File:        grid_home.zip
    Host Sw Stage Location:  /scratch/software/stage
    Inventory:               /u01/app/oraInventory
    Pga Size:                4G
    Processes:               2000
    Sga Size:                8G
    Sw Mount Location:       /u01
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Enable Ons:                 enable
  Image:                      dbocir/oracle/database-orestart:19.3.0-slim
  Image Pull Policy:          IfNotPresent
  Inst Details:
    Host Sw Location:  /scratch/orestart/
    Name:              dbmc1
    Worker Node:
      10.0.10.58
  Lb Service:
  Node Port Svc:
    Name:  dbmc1-service-nodeport
    Port Mappings:
      Node Port:    30007
      Port:         1521
      Protocol:     TCP
      Target Port:  1521
      Node Port:    30200
      Port:         6200
      Protocol:     TCP
      Target Port:  6200
    Svc Type:       nodeport
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Service Details:
    Name:  soepdb
  Ssh Key Secret:
    Key Mount Location:    /mnt/.ssh
    Name:                  ssh-key-secret
    Priv Key Secret Name:  ssh-privkey
    Pub Key Secret Name:   ssh-pubkey
Status:
  Oracle Restart Nodes:
    Name:  dbmc1-0
    Node Details:
      Instance State:  OPEN
      Pod State:       AVAILABLE
      Cluster State:   HEALTHY
      Mounted Devices:
        /dev/disk/by-partlabel/asm-disk1
      State:  AVAILABLE
  Asm Disk Groups:
    Disks:
      Name:        /dev/disk/by-partlabel/asm-disk1
      Size In Gb:  49
      Valid:       true
    Name:          DATA
    Redundancy:    EXTERN
    Type:          CRSDG
  Conditions:
    Last Transition Time:  2026-02-16T02:34:52Z
    Message:               reconcile completed successfully
    Observed Generation:   1
    Reason:                LastReconcileCycleCompleted
    Status:                True
    Type:                  ReconcileComplete
  Config Params:
    Db Base:  /u01/app/oracle
    Db Home:  /u01/app/oracle/product/19c/dbhome_1
    Db Name:  PORCLCDB
    Db Response File:
    Grid Base:  /u01/app/grid
    Grid Home:  /u01/app/19c/grid
    Grid Response File:
    Inventory:     /u01/app/oraInventory
  Connect String:  dbmc1-0:1521/PORCLCDB
  Db Secret:
    Key File Mount Location:  /mnt/.dbsecrets
    Key File Name:            key.pem
    Name:                     db-user-pass-pkutl
    Pwd File Mount Location:  /mnt/.dbsecrets
    Pwd File Name:            pwdfile.enc
  Db State:                   OPEN
  External Connect String:    129.146.0.149:30007/soepdb
  Pdb Connect String:         dbmc1-0:1521/ORCLPDB
  Release Update:             19.28.0.0.0
  Resources:
    Limits:
      Cpu:     4
      Memory:  16Gi
    Requests:
      Cpu:     4
      Memory:  16Gi
  Role:        PRIMARY
  Security Context:
    Sysctls:
      Name:   kernel.shmmax
      Value:  9663676416
      Name:   kernel.shmall
      Value:  2359296
      Name:   kernel.sem
      Value:  250 32000 100 128
      Name:   kernel.shmmni
      Value:  4096
  Service Details:
    Name:       soepdb
    Svc State:  service soepdb is running
  State:        AVAILABLE
Events:         <none>


-- From inside the Oracle Restart Database Pod:
[grid@dbmc1-0 ~]$
[grid@dbmc1-0 ~]$ export ORACLE_SID=+ASM
[grid@dbmc1-0 ~]$ asmcmd lsdsk
Path
/dev/disk/by-partlabel/asm-disk1
[grid@dbmc1-0 ~]$ ls -lrt /dev/disk/by-partlabel/asm-disk*
brw-rw----. 1 grid asmadmin 8, 33 Feb 16 03:22 /dev/disk/by-partlabel/asm-disk1