cscope 15 $HOME/WORKDIR/Ords22_operator/oracle-database-operator               0000008991
	@Makefile

1 #
#Cİyrighˆ(
c
è2022, 
O¿şe
 
ªd
/
Ü
 
™s
 
affŸ‹s
.

2 #Liûn£d 
und”
 
the
 
Univ”§l
 
P”missive
 
Liûn£
 
v
 1.0 
as
 
shown
 
©
 
h‰p
:

4 #Cu¼’ˆ
O³¿tÜ
 
v”siÚ


5 
	gVERSION
 ?= 0.0.1

6 #DeçuÉ 
bundË
 
image
 
g


7 
BUNDLE_IMG
 ?ğ
cÚŒŞËr
-
bundË
:
	$$
(
VERSION
)

9 
	`iâeq
 (
	`$
(
Üigš
 
CHANNELS
), 
undefšed
)

10 
BUNDLE_CHANNELS
 :ğ--
chªÃls
=
	$$
(
CHANNELS
)

11 
’dif


12 
	`iâeq
 (
	`$
(
Üigš
 
DEFAULT_CHANNEL
), 
undefšed
)

13 
BUNDLE_DEFAULT_CHANNEL
 :ğ---
chªÃl
=
	$$
(
DEFAULT_CHANNEL
)

14 
’dif


15 
BUNDLE_METADATA_OPTS
 ?ğ
	`$
(
BUNDLE_CHANNELS
è
	$$
(
BUNDLE_DEFAULT_CHANNEL
)

17 #Imag
URL
 
to
 
u£
 
®l
 
budšg
/
pushšg
 
image
 
rg‘s


18 
IMG
 ?ğ
cÚŒŞËr
:
Ï‹¡


19 #Produû 
CRDs
 
th©
 
wÜk
 
back
 
to
 
Kub”Ã‹s
 1.11 (
no
 
v”siÚ
 
cÚv”siÚ
)

20 #API 
v”siÚ
 
has
 
to
 
be
 
v1
Ø
u£
 
	`deçuÉšg
 (
h‰ps
:

21 
CRD_OPTIONS
 ?= "crd:trivialVersions=true,preserveUnknownFields=false"

22 #ENVTEST_K8S_VERSION 
»ãrs
 
to
 
the
 
v”siÚ
 
of
 
kubebud”
 
as£ts
Ø
be
 
dowÆßded
 
by
 
’v‹¡
 
bš¬y
.

23 
ENVTEST_K8S_VERSION
 = 1.21

24 #O³¿tÜ 
YAML
 
fe


25 
OPERATOR_YAML
=
	`$$
(
ba£Çme
 $$(
pwd
)).
yaml


27 #G‘ 
the
 
cu¼’y
 
u£d
 
gŞªg
 
š¡®l
 
	`·th
 (
š
 
GOPATH
/
bš
, 
uÆess
 
GOBIN
 
is
 
£t
)

28 
	`iãq
 (,
	$$
(
sh–l
 
go
 
’v
 
GOBIN
))

29 
GOBIN
=
	`$
(
sh–l
 
go
 
’v
 
GOPATH
)/
bš


31 
GOBIN
=
	$$
(
sh–l
 
go
 
’v
 
GOBIN
)

32 
’dif


34 #S‘tšg 
SHELL
 
to
 
bash
 
®lows
 bash 
commªds
Ø
be
 
execu‹d
 
by
 
»ces
.

35 #Thi 
is
 
a
 
»quœem’t
 '£tup-’v‹¡.sh' 
š
 
the
 
‹¡
 
rg‘
.

36 #O±iÚ 
¬e
 
£t
 
to
 
ex™
 
wh’
 
a
 
»ce
 
lše
 
ex™s
 
nÚ
-
z”o
 
Ü
‡ 
ped
 
commªd
 
çs
.

37 
SHELL
 = /
u¤
/
bš
/
’v
 
bash
 -
o
 
peç


38 .
SHELLFLAGS
 = -
ec


40 
®l
: 
bud


42 ##@ 
Dev–İm’t


44 
mªiã¡s
: 
cÚŒŞËr
-
g’
 ## 
G’”©e
 
WebhookCÚfigu¿tiÚ
, 
Clu¡”RŞe
 
ªd
 
Cu¡omResourûDefš™iÚ
 
objeùs
.

45 
	`$
(
CONTROLLER_GEN
è
	$$
(
CRD_OPTIONS
è
rbac
:
rŞeName
=
mªag”
-
rŞe
 
webhook
 
·ths
="./..." 
ouut
:
üd
:
¬tiçùs
:
cÚfig
=cÚfig/üd/
ba£s


47 
g’”©e
: 
cÚŒŞËr
-
g’
 ## 
G’”©e
 
code
 
cÚššg
 
D“pCİy
, 
D“pCİyIÁo
, 
ªd
 
D“pCİyObjeù
 
m‘hod
 
im¶em’tiÚs
.

48 
	$$
(
CONTROLLER_GEN
è
objeù
:
h—d”Fe
="hack/bo”¶©e.go.txt" 
·ths
="./..."

50 
fmt
: ## 
Run
 
go
 fmˆ
agaš¡
 
code
.

51 
go
 
fmt
 ./...

53 
v‘
: ## 
Run
 
go
 v‘ 
agaš¡
 
code
.

54 
go
 
v‘
 ./...

56 
TEST
 ?ğ./
­is
/
d©aba£
/
v1®pha1
 ./
commÚs
/... ./
cÚŒŞËrs
/...

57 
‹¡
: 
mªiã¡s
 
g’”©e
 
fmt
 
v‘
 
’v‹¡
 ## 
Run
 
un™
 
‹¡s
.

58 
KUBEBUILDER_ASSETS
="$(sh–È$(ENVTESTèu£ $(ENVTEST_K8S_VERSIONè-°·th)" 
go
 
‹¡
 
	`$
(
TEST
è-
cov”´ofe
 
cov”
.
out


60 
E2ETEST
 ?ğ./
‹¡
/
e2e
/

61 
e2e
: 
mªiã¡s
 
g’”©e
 
fmt
 
v‘
 
’v‹¡
 ## 
Run
ƒ2
‹¡s
.

62 
KUBEBUILDER_ASSETS
="$(sh–È$(ENVTESTèu£ $(ENVTEST_K8S_VERSIONè-°·th)" 
gškgo
 -
v
 --
timeout
=2
h30m
 --
ç
-
ç¡
 
	$$
(
E2ETEST
)

64 ##@ 
Bud


66 
bud
: 
g’”©e
 
fmt
 
v‘
 ## 
Bud
 
mªag”
 
bš¬y
.

67 
go
 
bud
 -
o
 
bš
/
mªag”
 
maš
.go

69 
run
: 
mªiã¡s
 
g’”©e
 
fmt
 
v‘
 ## 
Run
 
a
 
cÚŒŞËr
 
äom
 
your
 
ho¡
.

70 
go
 
run
 ./
maš
.go

72 
dock”
-
bud
: 
mªiã¡s
 
g’”©e
 
fmt
 
v‘
 #‹¡ ## 
Bud
 dock” 
image
 
w™h
 
the
 
mªag”
. 
Di§bË
h
‹¡
 
but
 
k“p
h
v®id©iÚs
 
to
 
ç
 
ç¡


73 
dock”
 
bud
 --
no
-
ÿche
=
Œue
 --bud-
¬g
 
h‰p_´oxy
=
$
{
HTTP_PROXY
} --bud-¬g h‰ps_´oxy=${HTTPS_PROXY} . -ˆ${IMG}

75 #dock”-
bud
-
´oxy
: 
‹¡


76 #dock” 
bud
 --bud-
¬g
 
h‰p_´oxy
=
$
{h‰p_´oxy} --bud-¬g 
h‰ps_´oxy
=${h‰ps_´oxy} bud . -
t
 ${
IMG
}

78 
dock”
-
push
: ## 
Push
 dock” 
image
 
w™h
 
the
 
mªag”
.

79 
dock”
 
push
 
$
{
IMG
}

81 ##@ 
D•loym’t


83 
š¡®l
: 
mªiã¡s
 
ku¡omize
 ## 
In¡®l
 
CRDs
 
što
 
the
 
K8s
 
şu¡”
 
¥ecif›d
 
š
 ~/.
kube
/
cÚfig
.

84 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/
üd
 | 
kubeùl
 
­¶y
 -
f
 -

86 
unš¡®l
: 
mªiã¡s
 
ku¡omize
 ## 
Unš¡®l
 
CRDs
 
äom
 
the
 
K8s
 
şu¡”
 
¥ecif›d
 
š
 ~/.
kube
/
cÚfig
.

87 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/
üd
 | 
kubeùl
 
d–‘e
 -
f
 -

89 
d•loy
: 
mªiã¡s
 
ku¡omize
 ## 
D•loy
 
cÚŒŞËr
 
to
 
the
 
K8s
 
şu¡”
 
¥ecif›d
 
š
 ~/.
kube
/
cÚfig
.

90 
cd
 
cÚfig
/
mªag”
 && 
	$$
(
KUSTOMIZE
è
ed™
 
£t
 
image
 
cÚŒŞËr
=
$
{
IMG
}

91 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/ | 
kubeùl
 
­¶y
 -
f
 -

94 #U£d 
£d
 
to
 
»pos™iÚ
 
the
 
cÚŒŞËr
-
mªag”
 
D•loym’t
 
aá”
h
û¹ifiÿ‹
 
ü—tiÚ
 
š
h
OPERATOR_YAML


95 
İ”©Ü
-
yaml
: 
mªiã¡s
 
ku¡omize


96 
cd
 
cÚfig
/
mªag”
 && 
	$$
(
KUSTOMIZE
è
ed™
 
£t
 
image
 
cÚŒŞËr
=
$
{
IMG
}

97 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/ > "${OPERATOR_YAML}"

98 
£d
 -
i
.
bak
 -
e
 '/^apiVersion:‡pps\/v1/,/---/d' "${OPERATOR_YAML}"

99 (
echo
 --- && 
£d
 '/^apiVersion:‡pps\/v1/,/---/!d' "${OPERATOR_YAML}.bak") >> "${OPERATOR_YAML}"

100 
rm
 "${OPERATOR_YAML}.bak"

102 
und•loy
: ## 
Und•loy
 
cÚŒŞËr
 
äom
 
the
 
K8s
 
şu¡”
 
¥ecif›d
 
š
 ~/.
kube
/
cÚfig
.

103 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/ | 
kubeùl
 
d–‘e
 -
f
 -

105 ##@ 
Bud
 
D•’d’c›s


107 ## 
LoÿtiÚ
 
to
 
š¡®l
 
d•’d’c›s
o

108 
LOCALBIN
 ?ğ
	`$
(
sh–l
 
pwd
)/
bš


109 
	$$
(
LOCALBIN
):

110 
mkdœ
 -
p
 
	$$
(
LOCALBIN
)

112 ## 
ToŞ
 
Bš¬›s


113 
KUSTOMIZE
 ?ğ
	`$
(
LOCALBIN
)/
ku¡omize


114 
CONTROLLER_GEN
 ?ğ
	`$
(
LOCALBIN
)/
cÚŒŞËr
-
g’


115 
ENVTEST
 ?ğ
	`$
(
LOCALBIN
)/
£tup
-
’v‹¡


117 ## 
ToŞ
 
V”siÚs


118 
KUSTOMIZE_VERSION
 ?ğ
v3
.8.7

119 
CONTROLLER_TOOLS_VERSION
 ?ğ
v0
.6.1

121 
KUSTOMIZE_INSTALL_SCRIPT
 ?= "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh"

122 .
PHONY
: 
ku¡omize


123 
ku¡omize
: 
	$$
(
KUSTOMIZE
è## 
DowÆßd
 
ku¡omize
 
loÿÎy
 
Ãûs§ry
.

124 
	$$
(
KUSTOMIZE
): 
	$$
(
LOCALBIN
)

125 
cu¾
 -
s
 
	`$
(
KUSTOMIZE_INSTALL_SCRIPT
è| 
bash
 - -- $(
sub¡
 
v
,,$(
KUSTOMIZE_VERSION
)è$(
LOCALBIN
)

127 .
PHONY
: 
cÚŒŞËr
-
g’


128 
cÚŒŞËr
-
g’
: 
	$$
(
CONTROLLER_GEN
è## 
DowÆßd
 
cÚŒŞËr
-
g’
 
loÿÎy
 
Ãûs§ry
.

129 
	$$
(
CONTROLLER_GEN
): 
	$$
(
LOCALBIN
)

130 
GOBIN
=
	$$
(
LOCALBIN
è
go
 
š¡®l
 
sigs
.
k8s
.
io
/
cÚŒŞËr
-
toŞs
/
cmd
/cÚŒŞËr-
g’
@
	`$
(
CONTROLLER_TOOLS_VERSION
)

132 .
PHONY
: 
’v‹¡


133 
’v‹¡
: 
	$$
(
ENVTEST
è## 
DowÆßd
 
’v‹¡
-
£tup
 
loÿÎy
 
Ãûs§ry
.

134 
	$$
(
ENVTEST
): 
	$$
(
LOCALBIN
)

135 
GOBIN
=
	$$
(
LOCALBIN
è
go
 
š¡®l
 
sigs
.
k8s
.
io
/
cÚŒŞËr
-
ruÁime
/
toŞs
/
£tup
-
’v‹¡
@
Ï‹¡


138 .
PHONY
: 
bundË


139 
bundË
: 
mªiã¡s
 
ku¡omize
 ## 
G’”©e
 bundË mªiã¡ 
ªd
 
m‘ad©a
, 
th’
 
v®id©e
 
g’”©ed
 
fes
.

140 
İ”©Ü
-
sdk
 
g’”©e
 
ku¡omize
 
mªiã¡s
 -
q


141 
cd
 
cÚfig
/
mªag”
 && 
	$$
(
KUSTOMIZE
è
ed™
 
£t
 
image
 
cÚŒŞËr
=
	`$
(
IMG
)

142 
	$$
(
KUSTOMIZE
è
bud
 
cÚfig
/
mªiã¡s
 | 
İ”©Ü
-
sdk
 
g’”©e
 
bundË
 -
q
 --
ov”wr™e
 --
v”siÚ
 
	`$
(
VERSION
è
	$$
(
BUNDLE_METADATA_OPTS
)

143 
İ”©Ü
-
sdk
 
bundË
 
v®id©e
 ./bundle

145 .
PHONY
: 
bundË
-
bud


146 
bundË
-
bud
: ## 
Bud
 
the
 bundË 
image
.

147 
dock”
 
bud
 -
f
 
bundË
.
Dock”fe
 -
t
 
	`$
(
BUNDLE_IMG
) .

149 .
PHONY
: 
bundË
-
push


150 
bundË
-
push
: ## 
Push
 
the
 bundË 
image
.

151 
	$$
(
MAKE
è
dock”
-
push
 
IMG
=
	`$
(
BUNDLE_IMG
)

153 .
PHONY
: 
İm


154 
OPM
 = ./
bš
/
İm


155 
İm
: ## 
DowÆßd
 opm 
loÿÎy
 
Ãûs§ry
.

156 
	`iãq
 (,
	`$
(
wdÿrd
 
	$$
(
OPM
)))

157 
	`iãq
 (,
	`$
(
sh–l
 
which
 
İm
 2>/
dev
/
nuÎ
))

159 
£t
 -
e
 ;\

160 
mkdœ
 -
p
 
	`$
(
dœ
 $(
OPM
)) ;\

161 
OS
=
	`$
(
sh–l
 
go
 
’v
 
GOOS
è&& 
ARCH
=$(sh–ÈgØ’v 
GOARCH
) && \

162 
cu¾
 -
sSLo
 
	`$
(
OPM
è
h‰ps
:

163 
chmod
 +
x
 
	`$
(
OPM
) ;\

164 
	}
}

166 
	gOPM
 = 
	$$
(
sh–l
 
which
 
İm
)

167 
’dif


168 
’dif


170 #A 
comma
-
£·¿‹d
 
li¡
 
of
 
bundË
 
	`images
 (
e
.
g
. 
make
 
ÿlog
-
bud
 
BUNDLE_IMGS
=
exam¶e
.
com
/
İ”©Ü
-bundË:
v0
.1.0,example.com/operator-bundle:v0.2.0).

171 #The£ 
images
 
MUST
 
exi¡
 
š
 
a
 
»gi¡ry
 
ªd
 
be
 
puÎ
-
abË
.

172 
BUNDLE_IMGS
 ?ğ
	$$
(
BUNDLE_IMG
)

174 #Th
image
 
g
 
giv’
 
to
 
the
 
»suÉšg
 
ÿlog
 
	`image
 (
e
.
g
. 
make
 c©®og-
bud
 
CATALOG_IMG
=
exam¶e
.
com
/
İ”©Ü
-ÿlog:
v0
.2.0).

175 
CATALOG_IMG
 ?ğ
	`$
(
IMAGE_TAG_BASE
)-
ÿlog
:
	$v$
(
VERSION
)

177 #S‘ 
CATALOG_BASE_IMG
 
to
 
ª
 
exi¡šg
 
ÿlog
 
image
 
g
Ø
add
 
$BUNDLE_IMGS
Ø
th©
 image.

178 
	`iâeq
 (
	`$
(
Üigš
 
CATALOG_BASE_IMG
), 
undefšed
)

179 
FROM_INDEX_OPT
 :ğ--
äom
-
šdex
 
	$$
(
CATALOG_BASE_IMG
)

180 
’dif


182 #Bud 
a
 
ÿlog
 
image
 
by
 
addšg
 
bundË
 
images
 
to
 
ª
 
em±y
 c©®og 
usšg
 
the
 
İ”©Ü
 
·ckage
 
mªag”
 
toŞ
, 'opm'.

183 #Thi 
»ce
 
švokes
 'İm' 
š
 '£mv”' 
bundË
 
add
 
mode
. 
FÜ
 
mÜe
 
šfÜm©iÚ
 
Ú
‡dd 
modes
, 
£e
:

185 .
PHONY
: 
ÿlog
-
bud


186 
ÿlog
-
bud
: 
İm
 ## 
Bud
 
a
 c©®og 
image
.

187 
	$$
(
OPM
è
šdex
 
add
 --
cÚš”
-
toŞ
 
dock”
 --
mode
 
£mv”
 --
g
 
	`$
(
CATALOG_IMG
è--
bundËs
 $(
BUNDLE_IMGS
è
	$$
(
FROM_INDEX_OPT
)

189 #Push 
the
 
ÿlog
 
image
.

190 .
PHONY
: 
ÿlog
-
push


191 
ÿlog
-
push
: ## 
Push
 
a
 c©®og 
image
.

192 
	$$
(
MAKE
è
dock”
-
push
 
IMG
=
	`$
(
CATALOG_IMG
)

	@
1
.
1
/usr/include
1
9
Makefile
